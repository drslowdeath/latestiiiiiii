<div
  x-data="totalsInvoice"
  class="p-2 text-xs rounded-md bg-vls3 text-vlp outline outline-1 outline-offset-4 outline-vls/80 dark:bg-vdp dark:text-vds dark:outline-vdp3">
  <div class="grid grid-cols-4 items-end gap-4">
    <!-- MARK: MAIN PRICE MENU -->
    <div class="text-lg font-medium">
      <h3>
        Subtotal:
        <span x-text="'£' + $store.invo.totals.subtotal"></span>
      </h3>

      <div class="flex items-center">
        <h3>
          Discount:
          <span x-show="$store.invo.totals.discountValue" class="text-red-500">-</span>
          <span
            x-text="$store.invo.totals.discountType === 1 ? $store.invo.totals.discountValue + '%' : '£' + $store.invo.totals.discountValue"></span>
          <span
            x-show="$store.invo.totals.discountType === 0"
            x-text="'(£' + $store.invo.totals.discountValue + ')'"
            class="ml-1"></span>
        </h3>
        <button
          x-show="$store.invo.totals.discount"
          @click="$store.invo.resetDiscounts"
          class="ml-2 text-red-600 hover:text-red-800">
          <svg width="16" height="16">
            <use href="/icons/icons.svg#trash"></use>
          </svg>
        </button>
      </div>

      <h3>
        VAT:
        <span x-text="'£' + $store.invo.totals.vat"></span>
      </h3>

      <div class="flex items-center">
        <h3>
          Total:
          <span x-text="'£' + $store.invo.totals.total"></span>
        </h3>
        <!-- <h3
          x-show="$store.invo.totals.discount"
          class="ml-2 line-through text-gray-500"
          x-text="'£' + preDiscountTotal"></h3> -->
      </div>

      <div x-show="$store.invo.totals.depositValue" class="flex items-center">
        <h3>
          Deposit:
          <span
            x-text="$store.invo.totals.depositType === 1 ? $store.invo.totals.depositValue + '%' : '£' + $store.invo.totals.depositValue"></span>
        </h3>
        <button @click="resetDeposit" class="ml-2 text-red-600 hover:text-red-800">
          <svg width="16" height="16">
            <use href="/icons/icons.svg#trash"></use>
          </svg>
        </button>
      </div>
    </div>

    <!-- MARK: DISCOUNT MODAL -->
    <div class="flex justify-center">
      <button
        @click="$store.invo.modDisc = !$store.invo.modDisc; if ($store.invo.modDisc) $nextTick(() => $refs.discountInput.focus())"
        x-ref="discountAnchor"
        class="flex items-center gap-2 modal-btn-prim !p-1.5">
        <svg class="size-4">
          <use href="/icons/icons.svg#trending-down"></use>
        </svg>
        Discount
      </button>
      <div x-show="$store.invo.modDisc" x-transition.duration.300 x-anchor.top.offset.10="$refs.discountAnchor">
        <div @keyup.escape="$store.invo.modDisc = false" class="z-10 p-4 bg-white border rounded shadow-md">
          <h3 class="text-lg font-semibold mb-2">Discount</h3>
          <input
            x-ref="discountInput"
            type="number"
            x-model.number="tempDiscount"
            placeholder="0"
            class="w-full p-2 border rounded mb-2" />
          <div class="flex justify-between">
            <button @click="confirmDiscount" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
              Apply
            </button>
            <button @click="resetDiscounts" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
              Reset
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- MARK: DEPOSIT MODAL -->
    <div class="flex justify-center">
      <button
        @click="$store.invo.modDepo = !$store.invo.modDepo; if ($store.invo.modDepo) $nextTick(() => $refs.depoInput.focus())"
        x-ref="depoAnchor"
        class="flex items-center gap-2 modal-btn-prim !p-1.5">
        <svg class="size-4">
          <use href="/icons/icons.svg#cash-bill"></use>
        </svg>
        Deposit
      </button>
      <div x-show="$store.invo.modDepo" x-transition.duration.300 x-anchor.top.offset.10="$refs.depoAnchor">
        <div @keyup.escape="$store.invo.modDepo = false" class="z-10 p-4 bg-white border rounded shadow-md">
          <h3 class="text-lg font-semibold mb-2">Deposit</h3>
          <input
            x-ref="depoInput"
            type="number"
            x-model.number="tempDeposit"
            placeholder="0"
            class="w-full p-2 border rounded mb-2" />
          <div class="flex justify-between">
            <button @click="confirmDeposit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
              Apply
            </button>
            <button @click="resetDeposit" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
              Reset
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- MARK: NOTE AND PDF -->
    <div class="flex flex-col items-end justify-between gap-2 h-full">
      <button
        @click="$store.invo.modNote = !$store.invo.modNote; if ($store.invo.modNote) $nextTick(() => $refs.noteInput.focus())"
        x-ref="noteAnchor"
        class="flex items-center gap-2 modal-btn-prim !p-1.5">
        <svg class="size-4">
          <use href="/icons/icons.svg#clipboard"></use>
        </svg>
        Note
      </button>
      <div
        x-show="$store.invo.modNote"
        @keyup.escape="$store.invo.modNote = false"
        x-transition.duration.300
        x-anchor.top.offset.10="$refs.noteAnchor">
        <div class="relative w-full max-w-xs mx-auto z-50">
          <textarea
            x-data="{ 
                    resize () { 
                        $el.style.height = '0px'; 
                        $el.style.height = $el.scrollHeight + 'px' 
                    } 
                }"
            x-init="resize()"
            @input="resize()"
            type="text"
            placeholder="Type your message here and press enter when you are ready to insert note into invoice."
            class="flex relative z-50 peer w-full h-auto min-h-[80px] px-3 py-2 text-sm bg-white border-2 border-neutral-900 placeholder:text-neutral-500 focus:text-neutral-800 focus:border-neutral-900 focus:outline-none focus:ring-0 disabled:cursor-not-allowed disabled:opacity-50"></textarea>
          <div
            class="absolute inset-0 z-10 w-full h-full -m-1 duration-300 ease-out translate-x-2 translate-y-2 bg-black peer-focus:m-0 peer-focus:translate-x-0 peer-focus:translate-y-0"></div>
        </div>
      </div>
      <button @click="generateInvoice" class="flex items-center gap-2 modal-btn-sec">
        <svg class="size-4">
          <use href="/icons/icons.svg#download-document"></use>
        </svg>
        PDF
      </button>
    </div>
  </div>
</div>
