<div
  x-data="totalsInvoice"
  class="p-2 text-xs rounded-md bg-vlp text-vls3 outline outline-1 outline-offset-8 outline-vls/80 dark:bg-vdp dark:text-vds dark:outline-vdp3">
  <div class="grid items-end grid-cols-4">
    <!--MARK: MAIN PRICE MENU COL 1 -->
    <div class="flex-col self-center text-lg font-medium align-middle">
      <h3>
        Subtotal:
        <span x-text="'£' + staticSubtotal"></span>
      </h3>
      <!-- MARK: Discount -->
      <div class="flex">
        <h3 class="flex">
          <span class="mr-1">Discount:</span>
          <span x-show="discount !== 0">-</span>
          <span x-text="symbol === '%' ? discount + '%' : '£' + discount"></span>
          <span x-show="discount !== 0 && isDiscountPercent === true" x-text="(`(£${discountValue})`)"></span>
        </h3>
        <button
          x-show="discount != 0"
          x-transition.duration.300
          @click="resetDiscounts();"
          class="table-interaction-icon-red">
          <svg width="20" height="20">
            <use href="/icons/icons.svg#trash" />
          </svg>
        </button>
      </div>
      <!-- MARK: Vat -->
      <h3 class="text-lg font-medium">
        VAT:
        <span>£</span>
        <span x-text="vat"></span>
      </h3>
      <!-- MARK: Total -->
      <div class="flex w-full">
        <h3 class="flex">
          Total:
          <span class="ml-1">£</span>
          <span x-text="total"></span>
        </h3>
        <h3 x-show="discount !== 0" x-transition.duration.300 class="ml-1 line-through text-vls dark:text-neutral-400">
          <span x-text="preDiscountTotal"></span>
        </h3>
      </div>
      <!-- MARK: Deposit -->
      <div class="flex w-full">
        <div x-show="deposit != 0" x-transition.opacity.duration.300>
          <h3 class="flex">
            <span class="mr-1">Deposit:</span>
            <!-- Display deposit as either percentage + numeric value or just numeric value -->
            <span x-text="depositSymbol === '%' ? depositDisplay : '£' + deposit"></span>
          </h3>
        </div>
        <button
          x-show="deposit !== 0"
          x-transition.opacity.duration.300
          @click="resetDeposit();"
          class="table-interaction-icon-red">
          <svg width="20" height="20">
            <use href="/icons/icons.svg#trash" />
          </svg>
        </button>
      </div>
    </div>
    <!-- MARK: DISCOUNT MODAL -->
    <div class="flex justify-center">
      <div class="relative inline-block">
        <button
          @click="popoverOpen = !popoverOpen; if(popoverOpen) $nextTick(() => $refs.discountInput.focus())"
          class="flex self-center gap-2 butt-style">
          <svg width="20" height="20">
            <use href="/icons/icons.svg#trending-down" />
          </svg>
          Discount
        </button>
        <div
          x-cloak
          x-show="popoverOpen"
          x-transition:enter="transition ease-out duration-300"
          @click.outside="popoverOpen = false"
          @keyup.esc="popoverOpen = false"
          x-transition:enter-start="opacity-0 translate-y-2"
          x-transition:enter-end="opacity-100 translate-y-0"
          x-transition:leave="transition ease-in duration-145"
          x-transition:leave-start="opacity-100 translate-y-0"
          x-transition:leave-end="opacity-0 -translate-y-10"
          class="absolute z-10 flex flex-col items-center justify-center origin-bottom bottom-full start-1/2 -ms-32 w-52 will-change-transform">
          <div class="modal-bg-and-borders overflow-hidden !p-6">
            <div class="relative">
              <div class="flex flex-col items-center justify-center mb-2">
                <h3 class="modal-title mb-4 !text-xl">Discount</h3>
                <!-- Input Value Discount -->
                <div class="relative mb-2">
                  <!-- 0 SYMBOL CONTROL WITH PADDING -->
                  <input
                    id="discount-input"
                    type="number"
                    placeholder="0"
                    x-model.number="tempDiscount"
                    x-ref="discountInput"
                    class="modal-input-style w-full !py-2 !pl-12" />
                  <!-- PERCENT SYMBOL CONTROL WITH PADDING -->
                  <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                    <span
                      x-text="symbol"
                      id="symbolIdDiscount"
                      class="text-lg text-vls2/80 hover:text-gray-200 focus:text-gray-200 dark:text-vds"></span>
                    <!-- PIPE SYMBOL CONTROL WITH MARGIN -->
                    <span class="absolute h-4 mx-2 ml-6 border-l border-gray-300"></span>
                  </div>
                </div>
              </div>

              <div class="flex justify-between mb-4">
                <button
                  id="toggle-discount-btn"
                  @click="switchOpen = !switchOpen; changeDiscount(); revolveSymbol('symbolIdDiscount')"
                  :class="switchOpen ? ' rounded bg-gray-100 text-gray-950 text-sm hover:bg-gray-300 transition duration-300 font-semibold' : ' rounded bg-vla2 text-white text-sm hover:bg-vla3 transition duration-300 font-semibold'"
                  class="px-1.5 py-1 transition duration-300">
                  <svg id="rotateIcon" width="20" height="20">
                    <use href="/icons/icons.svg#rotate" />
                  </svg>
                </button>
                <button
                  id="confirm-discount"
                  @click="confirmDiscount()"
                  x-transition
                  class="ml-4 rounded bg-vls2 dark:bg-vds2 px-1.5 py-1 text-sm font-semibold text-white dark:text-vds transition duration-300 hover:bg-gray-300"
                  :class="discount !== 0 ? 'bg-green-500 text-white hover:bg-green-600' : 'bg-gray-100 hover:bg-gray-300 text-gray-950'">
                  <svg width="20" height="20">
                    <use href="/icons/icons.svg#check" />
                  </svg>
                </button>
                <button
                  @click="resetDiscounts()"
                  class="ml-4 rounded bg-gray-600 px-1.5 py-1 text-white transition duration-300 hover:bg-gray-700">
                  <svg width="20" height="20">
                    <use href="/icons/icons.svg#xmark" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
          <div
            class="relative z-10 flex-none w-0 h-0 -mt-px border-t-8 border-e-8 border-s-8 border-e-transparent border-s-transparent border-t-vlp dark:border-t-zinc-900"
            aria-hidden="true"></div>
          <div
            class="relative z-0 -mt-[7px] h-0 w-0 flex-none border-e-8 border-s-8 border-t-8 border-e-transparent border-s-transparent border-t-vls2 dark:border-t-vds2"
            aria-hidden="true"></div>
        </div>
      </div>
    </div>
    <!-- MARK: DEPOSIT  MODAL-->
    <!-- DEPOSIT MENU COL 3-->
    <div class="flex justify-center">
      <div class="relative inline-block">
        <button
          @mouseenter="(trigger === 'hover focus') ? depositOpen = true : null"
          @click="(trigger === 'click') ? depositOpen = !depositOpen : null; if (depositOpen) { $nextTick(() => { $refs.tempDeposit.focus()}); }"
          type="button"
          class="flex self-center gap-2 butt-style">
          <svg width="20" height="20">
            <use href="/icons/icons.svg#cash-bill" />
          </svg>
          Deposit
        </button>
        <div
          x-cloak
          x-show="depositOpen"
          x-transition:enter="transition ease-out duration-300"
          @click.outside="depositOpen = false"
          @keyup.esc="depositOpen = false"
          x-transition:enter-start="opacity-0 translate-y-2"
          x-transition:enter-end="opacity-100 translate-y-0"
          x-transition:leave="transition ease-in duration-145"
          x-transition:leave-start="opacity-100 translate-y-0"
          x-transition:leave-end="opacity-0 -translate-y-10"
          class="absolute z-10 flex flex-col items-center justify-center origin-bottom bottom-full start-1/2 -ms-32 w-52 will-change-transform">
          <div class="modal-bg-and-borders overflow-hidden !p-6">
            <h3 class="modal-title mb-4 text-center !text-xl">Deposit</h3>
            <div class="relative my-4">
              <input
                x-ref="tempDeposit"
                class="modal-input-style w-full !py-2 !pl-12"
                type="number"
                min="0"
                placeholder="Enter deposit..."
                x-model="tempDeposit"
                :value="tempDeposit === 0 ? 0 : tempDeposit"
                :placeholder="tempDeposit === 0 ? 'Enter deposit...' : 0"
                @input="handleDepositInput(event)" />
              <!-- PERCENT SYMBOL CONTROL WITH PADDING -->
              <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <span
                  x-text="depositSymbol"
                  id="symbolIdDeposit"
                  class="text-lg text-vls2/80 hover:text-gray-200 focus:text-gray-200 dark:text-vds"></span>
                <!-- PIPE SYMBOL CONTROL WITH MARGIN -->
                <span class="absolute h-6 mx-2 ml-6 border-l border-gray-300"></span>
              </div>
            </div>
            <div class="flex justify-between mb-4">
              <button
                id="toggle-deposit"
                @click="isDepositPercent = ! isDepositPercent; handleDepositType(); revolveSymbol('symbolIdDeposit')"
                :class="!isDepositPercent ? ' rounded bg-gray-100 text-gray-950 text-sm hover:bg-gray-300 transition duration-300 font-semibold' : ' rounded bg-vla2 text-white text-sm hover:bg-vla3 transition duration-300 font-semibold'"
                class="px-1.5 py-1 transition duration-300">
                <svg id="toggle-deposit-btn" width="20" height="20">
                  <use href="/icons/icons.svg#rotate" />
                </svg>
              </button>
              <button
                id="confirm-deposit"
                @click="calculateDeposit()"
                x-transition
                class="ml-4 rounded bg-gray-100 px-1.5 py-1 text-sm font-semibold text-gray-950 transition duration-300 hover:bg-gray-300">
                <svg width="20" height="20">
                  <use href="/icons/icons.svg#check" />
                </svg>
              </button>
              <button
                @click="depositOpen = false"
                class="ml-4 rounded bg-gray-600 px-1.5 py-1 text-white transition duration-300 hover:bg-gray-700">
                <svg width="20" height="20">
                  <use href="/icons/icons.svg#xmark" />
                </svg>
              </button>
            </div>
          </div>
          <div
            class="relative z-10 flex-none w-0 h-0 -mt-px border-t-8 border-e-8 border-s-8 border-e-transparent border-s-transparent border-t-vlp dark:border-vds2"
            aria-hidden="true"></div>
          <div
            class="relative z-0 -mt-[7px] h-0 w-0 flex-none border-e-8 border-s-8 border-t-8 border-e-transparent border-s-transparent border-t-vls2 dark:border-t-vds2"
            aria-hidden="true"></div>
        </div>
      </div>
    </div>

    <!-- MARK: COL 4 NOTE PDF -->
    <div class="flex justify-between h-full">
      <!-- MARK: NOTE BUTTON -->
      <div>
        <div :class="invoiceNote !== '' ? 'hidden' : 'block'"></div>
        <div
          class="relative"
          @mouseover="hoverCardEnter()"
          @mouseleave="hoverCardLeave()"
          :class="invoiceNote !== '' ? 'fade-in-visible' : 'fade-out-hidden'"
          x-show="invoiceNote != ''">
          <div
            class="flex align-top transition-colors duration-300 text-vls hover:fill-vls hover:text-vla dark:text-vds dark:hover:fill-vred-300 dark:hover:text-vred-300"
            :class="invoiceNote !== '' ? 'fade-in-visible' : 'fade-out-hidden'">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="feather feather-file-text">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <button
              @click="removeMessage()"
              class="flex transition duration-300 fade-in-hidden fade-out-hidden justify-items-end text-vls hover:text-vla dark:text-vred-300"
              x-ref="removeBtn">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="12"
                height="12"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="feather feather-x-circle">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
            </button>
          </div>

          <div
            x-show="hoverCardHovered"
            class="absolute top-0 mt-5 translate-y-3 left-1/2 -z-50 w-72 max-w-72 -translate-x-3/4"
            x-cloak>
            <div
              x-show="hoverCardHovered"
              class="flex h-auto w-[full] items-start space-x-3 rounded-md border border-slate-300 bg-vlp p-4 shadow-sm dark:border-neutral-600 dark:bg-zinc-900"
              x-transition>
              <div class="flex w-full h-full text-vls dark:text-vds">
                <div class="flex items-center justify-center text-sm">
                  <p
                    x-text="invoiceNote"
                    class="font-normal fade-in-hidden fade-out-hidden text-wrap"
                    :class="invoiceNote !== '' ? 'fade-in-visible' : 'fade-out-hidden'"
                    x-ref="noteText"
                    x-show="invoiceNote != ''"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-col items-end justify-between h-full">
        <!-- MARK:NOTE POPOVER -->
        <div class="relative inline-block">
          <button
            @click=" invoiceNoteOpen = !invoiceNoteOpen; if (invoiceNoteOpen) { $nextTick(() => { $refs.invoiceNotePopover.focus()}); }"
            type="button"
            class="flex self-center gap-2 butt-style">
            <svg width="20" height="20">
              <use href="/icons/icons.svg#clipboard" />
            </svg>
            Invoicing Note
          </button>
          <div
            x-cloak
            x-show="invoiceNoteOpen"
            x-transition:enter="transition ease-out duration-300"
            @click.outside="invoiceNoteOpen = false"
            @keyup.esc="invoiceNoteOpen = false"
            x-transition:enter-start="opacity-0 translate-y-2"
            x-transition:enter-end="opacity-100 translate-y-0"
            x-transition:leave="transition ease-in duration-145"
            x-transition:leave-start="opacity-100 translate-y-0"
            x-transition:leave-end="opacity-0 -translate-y-10"
            class="absolute z-10 flex flex-col items-center justify-center origin-bottom bottom-full start-1/2 -ms-32 w-52 will-change-transform">
            <div class="modal-bg-and-borders overflow-hidden !p-6">
              <!-- TOOLTIP QUESTIONMARK -->
              <!-- MARK: INVOICE MESSAGE -->
              <!-- Custom Message for Deposit -->
              <div>
                <h3 class="modal-title mb-4 text-center !text-xl">Client Note</h3>
                <textarea
                  x-model="invoiceNotePopover"
                  x-ref="invoiceNotePopover"
                  @input="trackLength()"
                  rows="4"
                  class="modal-input-style w-full !p-2"
                  placeholder="Invoice note..."
                  style="resize: vertical; min-height: 100px; max-height: 300px"></textarea>
              </div>
              <div class="mb-4">
                <h1 x-transition.duration.300 class="mt-2 text-center text-small text-vls dark:text-vds">
                  Characters:
                  <span x-text="noteMaxLength"></span>
                  /
                  <span x-text="noteMaxLength - noteLength"></span>
                </h1>
              </div>
              <!-- Confirm Button -->
              <div class="flex justify-center">
                <button
                  @click="handleMessageSubmit()"
                  class="rounded bg-gray-100 px-1.5 py-1 text-sm font-semibold text-gray-950 transition duration-300 hover:bg-gray-300">
                  <svg width="20" height="20" class="">
                    <use href="/icons/icons.svg#check" />
                  </svg>
                </button>
              </div>
            </div>
            <div
              class="relative z-10 flex-none w-0 h-0 -mt-px border-t-8 border-e-8 border-s-8 border-e-transparent border-s-transparent border-t-vlp dark:border-t-zinc-900"
              aria-hidden="true"></div>
            <div
              class="relative z-0 -mt-[7px] h-0 w-0 flex-none border-e-8 border-s-8 border-t-8 border-e-transparent border-s-transparent border-t-vls2 dark:border-t-vds2"
              aria-hidden="true"></div>
          </div>
        </div>
        <!-- GENERATE PDF  -->
        <div>
          <button @click="generateInvoice" class="butt-style">
            <svg width="20" height="20" class="mr-1.5">
              <use href="/icons/icons.svg#download-document" />
            </svg>

            Generate PDF
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<div
  x-data="totalsInvoice"
  class="p-2 text-xs rounded-md bg-vlp text-vls3 outline outline-1 outline-offset-4 outline-vls/80 dark:bg-vdp dark:text-vds dark:outline-vdp3">
  <div class="grid grid-cols-4 items-center gap-4">
    <!-- MARK: MAIN PRICE MENU -->
    <div class="text-lg font-medium">
      <h3>
        Subtotal:
        <span x-text="'£' + staticSubtotal"></span>
      </h3>

      <div class="flex items-center">
        <h3>
          Discount:
          <span x-show="discount" class="text-red-500">-</span>
          <span x-text="symbol === '%' ? discount + '%' : '£' + discount"></span>
          <span x-show="discount && isDiscountPercent" x-text="'(£' + discountValue + ')'" class="ml-1"></span>
        </h3>
        <button x-show="discount" @click="resetDiscounts" class="ml-2 text-red-600 hover:text-red-800">
          <svg width="16" height="16">
            <use href="/icons/icons.svg#trash"></use>
          </svg>
        </button>
      </div>

      <h3>
        VAT:
        <span x-text="'£' + vat"></span>
      </h3>

      <div class="flex items-center">
        <h3>
          Total:
          <span x-text="'£' + total"></span>
        </h3>
        <h3 x-show="discount" class="ml-2 line-through text-gray-500" x-text="'£' + preDiscountTotal"></h3>
      </div>

      <div x-show="deposit" class="flex items-center">
        <h3>
          Deposit:
          <span x-text="depositSymbol === '%' ? depositDisplay : '£' + deposit"></span>
        </h3>
        <button @click="resetDeposit" class="ml-2 text-red-600 hover:text-red-800">
          <svg width="16" height="16">
            <use href="/icons/icons.svg#trash"></use>
          </svg>
        </button>
      </div>
    </div>

    <!-- MARK: DISCOUNT MODAL -->
    <div class="flex justify-center">
      <button
        @click="popoverOpen = !popoverOpen; if (popoverOpen) $nextTick(() => $refs.discountInput.focus())"
        class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        <svg width="20" height="20">
          <use href="/icons/icons.svg#trending-down"></use>
        </svg>
        Discount
      </button>
      <template x-if="popoverOpen">
        <div @click.outside="popoverOpen = false" class="absolute z-10 mt-2 p-4 bg-white border rounded shadow-md">
          <h3 class="text-lg font-semibold mb-2">Discount</h3>
          <input
            x-ref="discountInput"
            type="number"
            x-model.number="tempDiscount"
            placeholder="0"
            class="w-full p-2 border rounded mb-2" />
          <div class="flex justify-between">
            <button @click="confirmDiscount" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
              Apply
            </button>
            <button @click="resetDiscounts" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
              Reset
            </button>
          </div>
        </div>
      </template>
    </div>

    <!-- MARK: DEPOSIT MODAL -->
    <div class="flex justify-center">
      <button
        @click="depositOpen = !depositOpen; if (depositOpen) $nextTick(() => $refs.tempDeposit.focus())"
        class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        <svg width="20" height="20">
          <use href="/icons/icons.svg#cash-bill"></use>
        </svg>
        Deposit
      </button>
      <template x-if="depositOpen">
        <div @click.outside="depositOpen = false" class="absolute z-10 mt-2 p-4 bg-white border rounded shadow-md">
          <h3 class="text-lg font-semibold mb-2">Deposit</h3>
          <input
            x-ref="tempDeposit"
            type="number"
            x-model.number="tempDeposit"
            placeholder="Enter deposit..."
            class="w-full p-2 border rounded mb-2" />
          <div class="flex justify-between">
            <button @click="calculateDeposit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
              Apply
            </button>
            <button @click="resetDeposit" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
              Reset
            </button>
          </div>
        </div>
      </template>
    </div>

    <!-- MARK: NOTE AND PDF -->
    <div class="flex flex-col items-end gap-2">
      <button
        @click="invoiceNoteOpen = !invoiceNoteOpen; if (invoiceNoteOpen) $nextTick(() => $refs.invoiceNote.focus())"
        class="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">
        <svg width="20" height="20">
          <use href="/icons/icons.svg#clipboard"></use>
        </svg>
        Note
      </button>
      <button @click="generateInvoice" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
        <svg width="20" height="20" class="mr-1">
          <use href="/icons/icons.svg#download-document"></use>
        </svg>
        Generate PDF
      </button>
    </div>
  </div>
</div>
