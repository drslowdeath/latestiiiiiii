<div
  x-data="totalsInvoice"
  class="p-4 text-xs rounded-md w-full bg-vlp border-vls/40 border text-vls3 mb-4 dark:bg-vdp dark:text-vds dark:border-vls/40 shadow dark:shadow">
  <div class="grid grid-cols-4 items-end">
    <!-- MARK: MAIN PRICE MENU -->
    <div class="text-sm flex flex-col gap-4">
      <h2 class="font-semibold text-base leading-tight">Invoice Summary</h2>
      <h3>
        Subtotal:
        <span x-text="'£' + $store.invo.totals.subtotal"></span>
      </h3>

      <div class="flex items-center">
        <h3>
          Discount:
          <span x-show="$store.invo.totals.discountValue" class="text-red-500">-</span>
          <span
            x-text="$store.invo.totals.discountType === 1 ? $store.invo.totals.discountValue + '%' : '£' + $store.invo.totals.discountValue"></span>
          <span
            x-show="$store.invo.totals.discountType === 0"
            x-text="'(£' + $store.invo.totals.discountValue + ')'"
            class="ml-1"></span>
        </h3>
        <button
          x-show="$store.invo.totals.discount"
          @click="$store.invo.resetDiscounts"
          class="ml-2 text-red-600 hover:text-red-800">
          <svg width="16" height="16">
            <use href="/icons/icons.svg#trash"></use>
          </svg>
        </button>
      </div>

      <h3>
        VAT:
        <span x-text="'£' + $store.invo.totals.vat"></span>
      </h3>

      <div class="flex items-center">
        <h3>
          Total:
          <span x-text="'£' + $store.invo.totals.total"></span>
        </h3>
        <!-- <h3
          x-show="$store.invo.totals.discount"
          class="ml-2 line-through text-gray-500"
          x-text="'£' + preDiscountTotal"></h3> -->
      </div>

      <div x-show="$store.invo.totals.depositValue" class="flex items-center">
        <h3>
          Deposit:
          <span
            x-text="$store.invo.totals.depositType === 1 ? $store.invo.totals.depositValue + '%' : '£' + $store.invo.totals.depositValue"></span>
        </h3>
        <button @click="resetDeposit" class="ml-2 text-red-600 hover:text-red-800">
          <svg width="16" height="16">
            <use href="/icons/icons.svg#trash"></use>
          </svg>
        </button>
      </div>
    </div>

    <!-- MARK: DISCOUNT MODAL -->
    <div class="flex justify-center">
      <button
        @click="modDisc = !modDisc; if (modDisc) $nextTick(() => $refs.discountInput.focus())"
        x-ref="discountAnchor"
        class="modal-btn-prim">
        <svg class="size-4">
          <use href="/icons/icons.svg#trending-down"></use>
        </svg>
        Discount
      </button>
      <div
        x-show="modDisc"
        @keyup.escape="modDisc = false"
        @mouseenter="showXDisc = true"
        @mouseleave="showXDisc = false"
        x-transition.duration.300
        x-anchor.top.offset.10="$refs.discountAnchor">
        <div class="z-10 p-4 bg-white border-vls/40 border dark:bg-vdp2 text-vls3 rounded shadow-md">
          <div class="relative">
            <button
              x-show="showXDisc"
              @click="modDisc = false"
              x-transition.duration.300
              class="absolute !-top-3 !-right-3 table-interaction-icon-red">
              <svg class="size-5">
                <use href="/icons/icons.svg#xmark-circle"></use>
              </svg>
            </button>
          </div>
          <h3 class="mb-2 modal-title !text-lg !text-center">Discount</h3>
          <input
            x-ref="discountInput"
            type="number"
            x-model.number="tempDiscount"
            placeholder="0"
            class="modal-input-style mb-3" />
          <div class="flex justify-between">
            <button @click="$store.invo.addDiscount()" class="modal-btn-prim !place-self-center !text-xs">
              <svg class="size-4">
                <use href="/icons/icons.svg#check-circle"></use>
              </svg>
              Apply
            </button>
            <button @click="$store.invo.removeDiscount()" class="modal-btn-prim !place-self-center !text-xs">
              <svg class="size-4">
                <use href="/icons/icons.svg#rotate"></use>
              </svg>
              Reset
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- MARK: DEPOSIT MODAL -->
    <div class="flex justify-center">
      <button
        @click="modDepo = !modDepo; if (modDepo) $nextTick(() => $refs.depoInput.focus())"
        x-ref="depoAnchor"
        class="modal-btn-prim">
        <svg class="size-4">
          <use href="/icons/icons.svg#cash-bill"></use>
        </svg>
        Deposit
      </button>
      <div
        x-show="modDepo"
        @keyup.escape="modDepo = false"
        @mouseenter="showXDepo = true"
        @mouseleave="showXDepo = false"
        x-transition.duration.300
        x-anchor.top.offset.10="$refs.depoAnchor">
        <div class="z-10 p-4 bg-white border-vls/40 border dark:bg-vdp2 text-vls3 rounded shadow-md">
          <div class="relative">
            <button
              x-show="showXDepo"
              @click="modDepo = false"
              x-transition.duration.300
              class="absolute !-top-3 !-right-3 table-interaction-icon-red">
              <svg class="size-5">
                <use href="/icons/icons.svg#xmark-circle"></use>
              </svg>
            </button>
          </div>
          <h3 class="mb-2 modal-title !text-lg !text-center">Deposit</h3>
          <input
            x-ref="depoInput"
            type="number"
            x-model.number="tempDeposit"
            placeholder="0"
            class="modal-input-style mb-3" />
          <div class="flex justify-between">
            <button class="modal-btn-prim !place-self-center !text-xs">
              <svg class="size-4">
                <use href="/icons/icons.svg#check-circle"></use>
              </svg>
              Accept
            </button>
            <button title="Change invoice type - % or $" class="modal-btn-prim !place-self-center !text-xs">
              <svg class="size-4">
                <use href="/icons/icons.svg#rotate"></use>
              </svg>
              Change
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- MARK: NOTE AND PDF -->
    <div class="flex flex-col items-end justify-between gap-2 h-full">
      <button @click="generateInvoice" class="flex items-center gap-2 modal-btn-sec !p-1.5">
        <svg class="size-4">
          <use href="/icons/icons.svg#download-document"></use>
        </svg>
        PDF
      </button>
      <button
        @click="modNote = !modNote; if (modNote) $nextTick(() => $refs.noteInput.focus())"
        x-ref="noteAnchor"
        class="modal-btn-prim">
        <svg class="size-4">
          <use href="/icons/icons.svg#clipboard"></use>
        </svg>
        Note
      </button>
      <div
        x-show="modNote"
        @keyup.escape="modNote = false"
        @mouseenter="showX = true"
        @mouseleave="showX = false"
        x-transition.duration.300
        x-anchor.top.offset.10="$refs.noteAnchor">
        <div class="z-10 p-4 bg-white border-vls/40 border dark:bg-vdp2 text-vls3 rounded shadow-md">
          <div class="relative">
            <button
              x-show="showX"
              @click="modNote=false"
              x-transition.duration.300
              class="absolute !-top-3 !-right-3 table-interaction-icon-red">
              <svg class="size-5">
                <use href="/icons/icons.svg#xmark-circle"></use>
              </svg>
            </button>
          </div>
          <h3 class="mb-2 modal-title !text-lg !text-center">Note</h3>
          <input
            x-ref="noteInput"
            type="text"
            role="text"
            x-model="$store.invo.totals.note"
            placeholder="Note text..."
            class="modal-input-style mb-3" />
          <button class="modal-btn-prim !place-self-center">
            <svg class="size-4">
              <use href="/icons/icons.svg#check-circle"></use>
            </svg>
            accept
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
