<div x-data="editorManager">
  <div
    class="p-2 mb-12 align-baseline border justify-between flex rounded border-vls/40 dark:border-vls/40 dark:bg-vdp bg-white shadow">
    <button @click="$store.clients.showClientModal = true" class="modal-btn-prim">
      <svg class="size-4">
        <use href="/icons/icons.svg#select-client" />
      </svg>
      Select Client
    </button>
    <h3
      class="self-center text-vls2 dark:text-vds underline decoration-vla dark:decoration-vda"
      x-text="`${$store.clients.selectedClient.name || 'No selected client'}`"></h3>
  </div>
  <div class="flex h-screen rounded border border-vlp p-1 dark:border-neutral-600">
    <!-- MARK:INVOICE LIST -->
    <div class="w-1/3 p-2">
      <div class="alt-table-scrollbar max-h-[100%] overflow-y-auto rounded border border-transparent">
        <table class="w-[calc(100%-10px)]">
          <thead class="sticky top-0 z-10">
            <tr>
              <th
                class="round-left-border round-right-border border-clipper m-2 rounded bg-vlp text-vls dark:bg-zinc-900 dark:text-vds"
                style="box-shadow: 0 -4px 0 0 var(--border-clipper)">
                <p class="mb-2 font-medium">Invoice Book</p>
                <input
                  type="text"
                  placeholder="Search invoices..."
                  class="mr-2 flex w-full rounded border border-b-0 border-l-0 border-r-0 border-t-vlp bg-vlp p-1.5 text-xs font-normal text-vls transition duration-500 placeholder:text-vls hover:border-vred-300 hover:bg-vlp hover:text-vla hover:placeholder:text-vla focus:border-vred-300 focus:bg-vlp focus:text-vla focus:outline-none dark:border-neutral-700 dark:bg-neutral-700 dark:text-vds dark:placeholder:text-neutral-300 dark:hover:border-vred-300 dark:hover:text-vred-300 dark:hover:placeholder:text-vla dark:focus:border-vred-300 dark:focus:bg-vlp dark:focus:text-vla dark:focus:outline-none" />
              </th>
            </tr>
          </thead>
          <tbody class="max-h-[90%] overflow-y-auto pr-2">
            <template x-for="item in invoiceBook" :key="item.id">
              <tr>
                <td>
                  <button
                    @click="fetchItems(selectedClient.id, item.id); $refs.tempText.classList.add('hidden'); applyEffect(item)"
                    :id="'rowid-' + item.id"
                    class="mb-2 flex w-full cursor-default justify-between rounded border border-vlp bg-slate-600 p-1.5 text-vls transition duration-200 hover:border-vla hover:bg-slate-500 focus:border-vla focus:bg-slate-500 active:border-vla active:bg-slate-500 dark:bg-neutral-700 dark:hover:border-vred-300 dark:hover:bg-neutral-600 dark:hover:text-white dark:focus:border-vred-300 dark:active:border-vred-300">
                    <div class="mr-2 flex flex-col justify-start text-left text-xs">
                      <div x-text="item.client_name"></div>
                      <div x-text="item.date"></div>
                    </div>
                    <div>
                      <div class="flex self-end text-xs" x-text="item.invoice_number"></div>
                    </div>
                  </button>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>
    <!-- MARK: EDITOR -->
    <div id="invoice-editor" class="w-full">
      <div
        x-ref="tempText"
        class="flex h-full w-full items-center justify-center text-center align-middle text-vls dark:text-vds">
        <p class="text-2xl text-vlp dark:text-vds">Pick an invoice from the list to edit.</p>
      </div>
      <!-- MARK: NON EDIT STATE -->
      <template x-if="editing === false">
        <div class="alt-table-scrollbar max-h-[100%] w-full overflow-y-auto p-1.5">
          <template x-if="showInvoiceItems === true">
            <div x-show="showInvoiceItems" x-transition class="text-vls dark:text-vds">
              <!-- MARK: Header -->
              <div
                class="flex w-full justify-between rounded-b-none rounded-t-md bg-vlp p-2 text-center font-medium text-vls dark:bg-zinc-900">
                <div class="flex self-center">
                  <span class="mr-1">Invoice:</span>
                  <p class="mr-2" x-text="invoiceItems.invoice.invoice_number"></p>
                  <span class="mr-1">Date:</span>
                  <span x-text="invoiceItems.invoice.date"></span>
                </div>
              </div>
              <!-- MARK: Client details -->
              <div
                class="mb-2 flex h-full w-full justify-between rounded-b-md rounded-t-none border border-vlp bg-slate-600 p-1 dark:bg-neutral-700">
                <div class="flex flex-col">
                  <p class="mr-1">
                    Client name:
                    <span x-text="invoiceItems.client.name"></span>
                  </p>
                  <p class="mr-1">
                    Company:
                    <span x-text="invoiceItems.client.company_name"></span>
                  </p>
                  <p class="mr-1">
                    Address:
                    <span x-text="invoiceItems.client.address"></span>
                  </p>
                  <p class="mr-1">
                    Email:
                    <span x-text="invoiceItems.client.email"></span>
                  </p>
                </div>
                <div class="flex flex-col justify-between">
                  <button @click="generateInvoice()" class="flex items-center gap-2 modal-btn-sec !p-1.5">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#download-document"></use>
                    </svg>
                    PDF
                  </button>

                  <button
                    @click="openEditModal = true"
                    class="butt-style flex !w-full !bg-vlp !p-1.5 dark:!bg-zinc-900">
                    <button
                      @click="$store.pdfStore.generateInvoice()"
                      class="flex items-center gap-2 modal-btn-sec !p-1.5">
                      <svg class="size-4">
                        <use href="/icons/icons.svg#editor"></use>
                      </svg>
                      PDF
                    </button>
                    <span class="flex w-full justify-center text-center">Edit Invoice</span>
                  </button>
                </div>
              </div>
              <!-- MARK: Invoice Items Table -->
              <div
                class="alt-table-scrollbar mb-2 w-full overflow-y-auto rounded border border-vlp bg-slate-600 dark:bg-neutral-700">
                <table class="w-full table-auto text-vls dark:text-vds">
                  <thead class="sticky top-0 bg-vlp text-left font-medium dark:bg-zinc-900">
                    <tr>
                      <th class="p-1">Name</th>
                      <th class="p-1">Type</th>
                      <th class="p-1">Qty</th>
                      <th class="p-1">Price</th>
                    </tr>
                  </thead>
                  <tbody class="font-normal">
                    <template x-for="item in invoiceItems.invoiceItems" :key="item.id">
                      <tr>
                        <td x-text="item.name" class="p-1"></td>
                        <td x-text="item.type" class="p-1"></td>
                        <td x-text="item.quantity" class="p-1"></td>
                        <td x-text="'£' + item.price" class="p-1"></td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
              <!-- MARK: Prices -->
              <div
                class="flex w-full justify-center rounded-b-none rounded-t-md bg-vlp p-2 text-center font-medium text-vls dark:bg-zinc-900">
                Prices
              </div>
              <div
                class="flex flex-col rounded-b-md rounded-t-none border border-vlp bg-slate-600 p-1 dark:bg-neutral-700">
                <p class="mb-1" x-text="'Subtotal: ' + '£' + invoiceItems.invoice.subtotal"></p>
                <p class="mb-1" x-text="'VAT: ' + '£' + invoiceItems.invoice.vat"></p>
                <template x-if="invoiceItems.invoice.discount_flat === 1">
                  <p class="mb-1" x-text="'Discount: ' + '£' + invoiceItems.invoice.discount"></p>
                </template>
                <template x-if="invoiceItems.invoice.discount_percent === 1">
                  <p class="mb-1" x-text="'Discount: ' + invoiceItems.invoice.discount + '%'"></p>
                </template>
                <p class="mb-1" x-text="'Total: ' + '£' + invoiceItems.invoice.total"></p>
                <template x-if="invoiceItems.invoice.deposit_flat === 1">
                  <p x-text="'Deposit: ' + '£' + invoiceItems.invoice.deposit"></p>
                </template>
                <template x-if="invoiceItems.invoice.deposit_percent === 1">
                  <p class="mb-1" x-text="'Deposit: ' + invoiceItems.invoice.deposit + '%'"></p>
                </template>
                <p class="mb-1" x-text="'Note: ' + invoiceItems.invoice.note"></p>
              </div>
            </div>
          </template>
        </div>
      </template>
      <!-- MARK: EDIT STATE -->
      <template x-if="editing === true">
        <div class="alt-table-scrollbar max-h-[100%] w-full overflow-y-auto p-2">
          <div x-show="showInvoiceItems" x-transition class="text-vls dark:text-vds">
            <!-- MARK: Header -->
            <div
              class="flex w-full rounded-b-none rounded-t-md bg-vlp p-2 text-center font-medium text-vls dark:bg-zinc-900">
              <div class="flex">
                <span class="mr-1">Invoice:</span>
                <p class="mr-2" x-text="invoiceItems.invoice.invoice_number"></p>
                <span class="mr-1">Date:</span>
                <span x-text="invoiceItems.invoice.date" class="mr-2"></span>
                <span>
                  -
                  <span x-show="editMode === 'editOverwrite'">Overwrite</span>
                  <span x-show="editMode === 'editCopy'">Copy</span>
                </span>
              </div>
            </div>
            <!-- MARK: Client Information -->
            <div
              class="mb-2 flex justify-between rounded-b-md rounded-t-none border border-vlp bg-slate-600 p-2 dark:bg-neutral-700">
              <div class="flex flex-col">
                <p>
                  Client name:
                  <span x-text="invoiceItems.client.name"></span>
                </p>
                <p>
                  Company:
                  <span x-text="invoiceItems.client.company_name"></span>
                </p>
                <p>
                  Address:
                  <span x-text="invoiceItems.client.address"></span>
                </p>
                <p>
                  Email:
                  <span x-text="invoiceItems.client.email"></span>
                </p>
              </div>

              <div class="flex flex-col justify-between">
                <button
                  title="Add new invoice item"
                  @click="existingItems.showItemModal = true; fetchStylesAndSamples(selectedClient.id)"
                  class="butt-style flex self-center !bg-vlp dark:!bg-zinc-900">
                  Add Item
                </button>
                <div class="flex justify-between">
                  <button
                    title="Save edit"
                    class="flex rounded-full align-middle text-vls transition duration-300 hover:text-sky-500 dark:text-vls dark:hover:text-sky-400"
                    @click="saveEdit()">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#check-circle"></use>
                    </svg>
                  </button>
                  <button
                    title="Cancel edit"
                    class="flex self-end rounded-full align-middle text-vls transition duration-300 hover:text-vla dark:text-vls dark:hover:text-vred-300"
                    @click="cancelEdit()">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#xmark-circle"></use>
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- MARK: Invoice Items Table -->
            <div
              class="alt-table-scrollbar mb-2 w-full overflow-y-auto rounded border border-vlp bg-slate-600 dark:bg-neutral-700">
              <table class="w-full text-vls dark:text-vds">
                <thead class="sticky top-0 bg-vlp text-left font-medium dark:bg-zinc-900">
                  <tr>
                    <th class="w-1/2 p-2">Name</th>
                    <th class="w-fit p-2">Type</th>
                    <th class="w-fit p-2">Qty</th>
                    <th class="w-fit p-2">Price</th>
                    <th class="flex w-full justify-center p-2">
                      <!-- MARK:ADD ITEM BTNS -->
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <template x-for="item in invoiceItems.invoiceItems" :key="item.id">
                    <tr>
                      <td class="w-1/2 p-1" x-text="item.name"></td>
                      <td class="w-fit p-1" x-text="item.type"></td>
                      <td class="w-fit p-1" x-text="item.quantity"></td>
                      <td class="w-fit p-1" x-text="'£' + item.price"></td>
                      <td class="items flex w-full justify-center p-1">
                        <!-- Remove Item -->
                        <button
                          title="Remove item"
                          @click="removeInvoiceItem(item.id)"
                          class="mt-1 flex self-end rounded-full align-middle text-vls transition duration-300 hover:text-vla dark:text-vds dark:hover:text-vred-300">
                          <svg class="size-4">
                            <use href="/icons/icons.svg#trash"></use>
                          </svg>
                        </button>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>

            <!-- MARK: Editable Prices -->
            <div
              class="flex w-full justify-center rounded-b-none rounded-t-md bg-vlp p-2 text-center font-medium text-vls dark:bg-zinc-900">
              Prices
            </div>
            <div
              class="flex flex-col rounded-b-md rounded-t-none border border-vlp bg-slate-600 p-1 dark:bg-neutral-700">
              <!-- Subtotal -->
              <div class="mb-1 flex">
                <span class="mr-2">Subtotal:</span>
                <span
                  x-show="editingPrice === ''"
                  x-text="'£' + invoiceItems.invoice.subtotal"
                  x-transition:enter.duration.300ms
                  x-transition:leave.duration.300ms></span>
              </div>

              <!-- VAT -->
              <div class="mb-1 flex">
                <span class="mr-2">VAT:</span>
                <span
                  x-show="editingPrice === ''"
                  x-text="'£' + invoiceItems.invoice.vat"
                  x-transition:enter.duration.300ms
                  x-transition:leave.duration.300ms></span>
              </div>

              <!-- MARK: Discount -->
              <div
                class="mb-1 flex"
                x-show="invoiceItems.invoice.discount > 0"
                x-transition:enter.duration.300ms
                x-transition:leave.duration.300ms>
                <!-- Not editing -->
                <span class="mr-2">Discount:</span>
                <div
                  class="mr-2 flex"
                  x-show="editingPrice === ''"
                  x-transition:enter.duration.300ms
                  x-transition:leave.duration.300ms>
                  <template x-if="invoiceItems.invoice.discount_flat === 1">
                    <span x-text="`-£${invoiceItems.invoice.discount}`"></span>
                  </template>
                  <template x-if="invoiceItems.invoice.discount_percent === 1">
                    <span
                      x-text="`-${invoiceItems.invoice.discount_percent_value}%` + `(£${invoiceItems.invoice.discount})`"></span>
                  </template>
                  <button
                    @click="editingPrice = 'discount'; editingPriceValue = invoiceItems.invoice.discount"
                    class="ml-2 text-vls transition duration-300 hover:text-vla dark:text-vds dark:hover:text-vla">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#editor"></use>
                    </svg>
                  </button>
                </div>
                <!-- Editing -->
                <div
                  x-show="editingPrice === 'discount'"
                  x-transition:enter.duration.300ms
                  x-transition:leave.duration.300ms
                  class="mb-0.5 flex items-center">
                  <input class="table-edit-input-style mr-2 !w-32" x-model.number="editingPriceValue" />
                  <button
                    class="mr-2 text-vls transition duration-300 hover:text-sky-500 dark:text-vls dark:hover:text-sky-400"
                    @click="savePrice('discount', editingPriceValue)">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#check-circle"></use>
                    </svg>
                  </button>
                  <button
                    class="text-vls transition duration-300 hover:text-vla dark:text-vds dark:hover:text-vla"
                    @click="editingPrice = ''">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#xmark-circle"></use>
                    </svg>
                  </button>
                </div>
              </div>
              <!-- MARK: Total -->
              <div class="mb-1 flex">
                <!-- Not editing -->
                <span class="mr-2">Total:</span>
                <div
                  class="flex"
                  x-show="editingPrice === ''"
                  x-transition:enter.duration.300ms
                  x-transition:leave.duration.300ms>
                  <span class="mr-2" x-text="'£' + invoiceItems.invoice.total"></span>
                  <button
                    @click="editingPrice = 'total'; editingPriceValue = invoiceItems.invoice.total"
                    class="text-vls transition duration-300 hover:text-vla dark:text-vds dark:hover:text-vla">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#check-circle"></use>
                    </svg>
                  </button>
                </div>
                <!-- Editing -->
                <div
                  x-show="editingPrice === 'total'"
                  x-transition:enter.duration.300ms
                  x-transition:leave.duration.300ms
                  class="mb-0.5 flex items-center">
                  <input class="table-edit-input-style mr-2 !w-32" x-model.number="editingPriceValue" />
                  <button
                    class="text-vls transition duration-300 hover:text-sky-500 dark:text-vls dark:hover:text-sky-400"
                    @click="savePrice('total', editingPriceValue)">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#check-circle"></use>
                    </svg>
                  </button>
                  <button
                    class="text-vls transition duration-300 hover:text-vla dark:text-vds dark:hover:text-vla"
                    @click="editingPrice = ''">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#xmark-circle"></use>
                    </svg>
                  </button>
                </div>
              </div>
              <!-- MARK: Deposit -->
              <div
                class="mb-1 flex"
                x-show="invoiceItems.invoice.deposit > 0"
                x-transition:enter.duration.300ms
                x-transition:leave.duration.300ms>
                <!-- Not editing -->
                <span class="mr-2">Deposit:</span>
                <div
                  class="mr-2 flex"
                  x-show="editingPrice === ''"
                  x-transition:enter.duration.300ms
                  x-transition:leave.duration.300ms>
                  <template x-if="invoiceItems.invoice.deposit_flat === 1">
                    <span x-text="` £${invoiceItems.invoice.deposit}`"></span>
                  </template>
                  <template x-if="invoiceItems.invoice.deposit_percent === 1">
                    <span
                      x-text="`${invoiceItems.invoice.deposit_percent_value}%` + `(£${invoiceItems.invoice.deposit})`"></span>
                  </template>
                  <button
                    @click="editingPrice = 'deposit'; editingPriceValue = invoiceItems.invoice.deposit"
                    class="ml-2 text-vls transition duration-300 hover:text-vla dark:text-vds dark:hover:text-vla">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#editor"></use>
                    </svg>
                  </button>
                </div>
                <!-- Editing -->
                <div
                  x-show="editingPrice === 'deposit'"
                  x-transition:enter.duration.300ms
                  x-transition:leave.duration.300ms
                  class="mb-0.5 flex items-center">
                  <input class="table-edit-input-style mr-2 !w-32 !p-1 !text-sm" x-model.number="editingPriceValue" />
                  <button
                    class="mr-2 text-vls transition duration-300 hover:text-sky-500 dark:text-vls dark:hover:text-sky-400"
                    @click="savePrice('deposit', editingPriceValue)">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#check-circle"></use>
                    </svg>
                  </button>
                  <button
                    class="text-vls transition duration-300 hover:text-vla dark:text-vds dark:hover:text-vla"
                    @click="editingPrice = ''; editingPriceValue = ''">
                    <svg class="size-4">
                      <use href="/icons/icons.svg#xmark-circle"></use>
                    </svg>
                  </button>
                </div>
              </div>
              <!-- MARK: Note -->
              <div class="mb-1 flex items-center">
                <span class="mr-2">Note:</span>
                <input class="table-edit-input-style !w-11/12" x-model="invoiceItems.invoice.note" maxlength="217" />
              </div>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>
  <!-- NEED TO FIX DEPOSIT SO THAT IT DISPLAYS as £ and % properly -->
  <!-- For this I need to use deposit_percent and deposit_flat vars -->

  <!-- MARK: EDIT MODAL -->
  <div x-show="openEditModal" x-transition.opacity.duration.300 class="fixed inset-0 z-20 bg-gray-800 bg-opacity-50">
    <div
      class="relative top-1/3 z-30 mx-auto w-1/4 rounded border border-slate-300 bg-vlp text-vls shadow-lg transition duration-300 dark:bg-zinc-900 dark:text-vds"
      @keydown.escape.window="openEditModal = false"
      @click.outside="openEditModal = false">
      <div class="p-4 text-center">
        <h2 class="text-xl font-medium text-vls dark:text-vds">Chose edit type</h2>
        <p class="mb-4 text-sm font-normal text-vls dark:text-vds">How would you like to edit the invoice?</p>

        <!-- Overwrite Invoice -->
        <label for="editorOverwrite" class="modal-input-style mb-2 flex items-center justify-between p-2 font-medium">
          <div>
            <div class="flex h-full w-full flex-row items-center justify-center">
              <input
                type="radio"
                id="editorOverwrite"
                name="overwrite"
                value="editOverwrite"
                class="mx-2 translate-y-px text-lg text-vlp focus:ring-vla dark:text-vds"
                x-model="editMode" />
              <span class="pl-1.5">Overwrite current invoice.</span>
            </div>
          </div>
          <button
            title="Click me."
            @click="callInfo('Overwrite.', 'Saves changes into existing invoice. Keeps original invoice number.')"
            class="text-vls transition duration-300 hover:text-vla dark:text-vds dark:hover:text-vred-300">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="feather feather-help-circle">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
          </button>
        </label>
        <!-- Copy Invoice -->
        <label for="editorCopy" class="modal-input-style mb-4 flex items-center justify-between p-2 font-medium">
          <div>
            <div class="flex h-full w-full flex-row items-center justify-center">
              <input
                type="radio"
                id="editorCopy"
                name="copy"
                value="editCopy"
                class="mx-2 translate-y-px text-lg text-vlp focus:ring-vla dark:text-vds"
                x-model="editMode" />
              <span class="pl-1.5">Save a copy of the invoice.</span>
            </div>
          </div>
          <button
            title="Click me."
            @click="callInfo('Create a new copy', 'Use this for all official client correspondence.')"
            class="text-vls transition duration-300 hover:text-vla dark:text-vds dark:hover:text-vred-300">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="feather feather-help-circle">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
          </button>
        </label>

        <button
          @click="editInvoice()"
          class="submit-button mb-2 w-full rounded bg-sky-700 p-1 text-base font-medium text-slate-100 shadow-sm transition-colors duration-200 hover:bg-sky-800 focus:outline-none focus:ring-2 focus:ring-sky-600">
          Edit
        </button>
        <button
          @click="openEditModal = false; editMode = ''"
          class="submit-button w-full rounded bg-red-800 p-1 text-base font-medium text-slate-100 shadow-sm transition-colors duration-200 hover:bg-red-900 focus:outline-none focus:ring-2 focus:ring-red-500">
          Close
        </button>
      </div>
    </div>
  </div>
  <!-- MARK: NEW I_ITEM MODAL -->
  <div
    x-show="existingItems.showItemModal"
    x-transition.opacity.duration.300ms
    class="fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-800 bg-opacity-50">
    <div
      class="max-w-1/4 relative top-1/4 mx-auto w-1/3 rounded border border-slate-300 bg-vlp text-vls shadow-lg dark:border-neutral-300 dark:bg-zinc-900 dark:text-vds">
      <div
        class="text-center"
        @click.outside="existingItems.showItemModal = false; existingItems.openDropdown = false"
        @keydown.escape.window="existingItems.showItemModal = false; existingItems.openDropdown = false">
        <!-- MARK:Existing items dropdown -->
        <div class="p-4">
          <h3 class="text-xl font-medium" x-text="`${selectedClient.name}'s Items`"></h3>
          <p class="mb-2 text-center text-sm font-normal">Add from existing styles and samples</p>
          <div class="relative" @click.outside="existingItems.openDropdown = false">
            <button
              x-ref="existingItemsDropdown"
              @click="existingItems.openDropdown = !existingItems.openDropdown"
              :class="{'border-vla dark:border-vred-300 text-vla dark:text-vred-300': existingItems.openDropdown, 'border-slate-300 dark:border-neutral-300 text-slate-300 dark:text-vds': !existingItems.openDropdown}"
              class="mb-4 w-full rounded border p-2 text-vls transition duration-300 hover:border-vla hover:text-vla focus:outline-none dark:border-neutral-300 dark:text-vds dark:hover:border-vred-300 dark:hover:text-vred-300">
              Items
            </button>
            <div
              x-anchor.offset.5="$refs.existingItemsDropdown"
              x-show="existingItems.openDropdown"
              x-collapse.duration.500ms
              class="table-scrollbar max-h-80 w-full overflow-auto rounded border border-slate-300 bg-vlp shadow-lg dark:border-neutral-300 dark:bg-neutral-600">
              <table class="w-full text-vls dark:text-vds">
                <thead class="sticky top-0 bg-vlp dark:bg-zinc-900">
                  <tr class="sticky w-full">
                    <input
                      type="text"
                      class="w-full bg-vlp p-1 text-center text-vla placeholder-vls transition-all duration-300 hover:placeholder-vla focus:outline-vla dark:bg-zinc-900 dark:text-vred-300 dark:placeholder-neutral-300 dark:hover:placeholder-vred-300 dark:focus:outline-vred-300"
                      placeholder="Seach items..."
                      x-model="existingItems.searchQuery"
                      @input="searchItems()" />
                  </tr>
                  <tr>
                    <th class="ml-2 p-1 text-left">Name</th>
                    <th class="p-1 text-right">Price</th>
                    <th class="p-1 text-right">Time</th>
                    <th class="p-1 text-center">Qty</th>
                  </tr>
                </thead>
                <tbody>
                  <template x-for="item in existingItems.filteredItems" :key="item.frontEndId">
                    <tr
                      class="cursor-default bg-slate-600 transition duration-200 hover:bg-slate-500 dark:bg-neutral-700 dark:hover:bg-neutral-500"
                      :id="item.frontEndId">
                      <td class="p-1 text-left text-sm" x-text="item.name"></td>
                      <td class="p-1 text-right text-sm" x-text="item.price"></td>
                      <td class="p-1 text-right text-sm" x-text="item.type === 'sample' ? item.time : 'N/A'"></td>
                      <td class="p-1 text-sm">
                        <div class="flex items-center justify-center">
                          <input
                            type="number"
                            name="newItemInput"
                            min="1"
                            maxlength="10"
                            placeholder="1"
                            x-model.number="item.quantity"
                            class="hover:border-vlp-400 focus:border-vlp-400 placeholder-vls-100 dark:text-vpalered-300 dark:placeholder-vpalered-300 w-10 rounded border border-slate-300 bg-slate-600 p-0.5 text-vls transition duration-300 hover:bg-slate-400 focus:bg-slate-400 focus:outline-none dark:border-neutral-400 dark:bg-neutral-600 dark:hover:border-vred-300 dark:focus:border-vred-300" />
                          <button
                            @click="addNewItem(item); applyEffect(item)"
                            class="druation-300 ml-2 text-vls transition hover:text-blue-400 dark:text-vds dark:hover:text-blue-400">
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="18"
                              height="18"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              class="feather feather-plus-circle">
                              <circle cx="12" cy="12" r="10"></circle>
                              <line x1="12" y1="8" x2="12" y2="16"></line>
                              <line x1="8" y1="12" x2="16" y2="12"></line>
                            </svg>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>
          </div>

          <h2 class="text-xl font-medium">Add New Item</h2>
          <!-- MARK: Labels for new item type -->
          <p class="mb-2 text-center text-sm font-normal">Chose item type</p>
          <div class="mb-4 flex justify-evenly">
            <!-- STYLE -->
            <label for="style" class="modal-input-style flex !w-28 items-center p-4">
              <div class="flex items-center">
                <input
                  type="radio"
                  id="style"
                  name="style"
                  value="style"
                  class="ml-2"
                  x-model="newItem.type"
                  @click="setTimeout(() => {
                      $nextTick(() => {$refs.newStyleName.focus()})
                    }, 300)" />
                <span class="pl-4">Style</span>
              </div>
            </label>
            <!-- SAMPLE -->
            <label for="sample" class="modal-input-style flex !w-28 items-center p-4">
              <div class="flex items-center">
                <input
                  type="radio"
                  id="sample"
                  name="sample"
                  value="sample"
                  class="ml-2 mr-4"
                  x-model="newItem.type"
                  @click="setTimeout(() => {
                      $nextTick(() => {$refs.newSampleName.focus()})
                    }, 300)" />
                <span>Sample</span>
              </div>
            </label>
          </div>
          <!-- MARK: Add New Style  -->
          <div x-show="newItem.type === 'style'" x-collapse.duration.300ms>
            <p class="mb-2 text-center text-lg font-medium text-vls dark:text-vds">Style</p>

            <input
              x-model="newItem.name"
              x-ref="newStyleName"
              name="name"
              type="text"
              placeholder="Style Name"
              class="modal-input-style mb-2 w-full !p-1 text-sm"
              required />
            <input
              x-model="newItem.price"
              name="price"
              type="number"
              min="0"
              step="0.01"
              placeholder="Individual Price"
              class="modal-input-style mb-2 w-full !p-1 text-sm"
              required />
            <input
              x-model="newItem.quantity"
              name="quantity"
              type="number"
              min="1"
              step="1"
              placeholder="Quantity"
              class="modal-input-style mb-4 w-full !p-1 text-sm"
              required />
            <button
              type="submit"
              class="submit-button mr-4 w-1/3 rounded bg-sky-700 p-1 text-base font-medium text-slate-100 shadow-sm transition-colors duration-200 hover:bg-sky-800 focus:outline-none focus:ring-2 focus:ring-sky-600">
              Add
            </button>
            <button
              @click="newItem.type = ''"
              class="submit-button w-1/3 rounded bg-red-800 p-1 text-base font-medium text-slate-100 shadow-sm transition-colors duration-200 hover:bg-red-900 focus:outline-none focus:ring-2 focus:ring-red-500">
              Back
            </button>
          </div>
          <!-- MARK: Add Sample -->
          <div x-show="newItem.type === 'sample'" x-collapse.duration.300ms>
            <p class="mb-2 text-center text-xl font-medium text-vls dark:text-vds">Sample</p>
            <input
              x-model="newItem.name"
              x-ref="newSampleName"
              name="name"
              type="text"
              placeholder="Sample Name"
              class="modal-input-style mb-2 w-full !p-1 text-sm"
              required />
            <input
              x-model="newItem.price"
              name="price"
              type="number"
              min="0"
              step="0.01"
              placeholder="Individual Price"
              class="modal-input-style mb-2 w-full !p-1 text-sm"
              required />

            <input
              x-model="newItem.time"
              name="time"
              type="number"
              min="0"
              step="0.1"
              placeholder="Time (in minutes)"
              class="modal-input-style mb-2 w-full !p-1 text-sm"
              required />
            <input
              x-model="newItem.quantity"
              name="quantity"
              type="number"
              min="1"
              step="1"
              placeholder="Quantity"
              class="modal-input-style mb-4 w-full !p-1 text-sm"
              required />
            <button
              class="submit-button mr-4 w-1/3 rounded bg-sky-700 p-1 text-base font-medium text-slate-100 shadow-sm transition-colors duration-200 hover:bg-sky-800 focus:outline-none focus:ring-2 focus:ring-sky-600">
              Add
            </button>
            <button
              @click="newItem.type = ''"
              class="submit-button w-1/3 rounded bg-red-800 p-1 text-base font-medium text-slate-100 shadow-sm transition-colors duration-200 hover:bg-red-900 focus:outline-none focus:ring-2 focus:ring-red-500">
              Back
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MARK: SELECT CLIENT MODAL -->
  <div
    x-show="showClientModal"
    x-transition.opacity.duration.300ms
    class="fixed inset-0 z-20 bg-gray-800 bg-opacity-50">
    <div
      class="relative top-1/3 z-30 mx-auto w-1/3 rounded border border-slate-300 bg-vlp text-vls shadow-lg transition duration-300 dark:border-neutral-300 dark:bg-zinc-900 dark:text-vds"
      @keydown.escape.window="showClientModal = false"
      @click.outside="showClientModal = false">
      <div class="p-6">
        <h2 class="mb-4 text-center text-xl font-medium">Select Client</h2>
        <div class="relative" @click.outside="showDropdown = false">
          <button
            x-ref="clientModalButton"
            @click="showDropdown = !showDropdown"
            :class="{'border-vla dark:border-vred-300 text-vla dark:text-vred-300': showDropdown, 'border-slate-300 dark:border-neutral-300 text-slate-300 dark:text-vds': !showDropdown}"
            class="mb-4 w-full rounded border p-2 text-vls transition duration-300 hover:border-vla hover:text-vla focus:outline-none dark:border-neutral-300 dark:text-vds dark:hover:border-vred-300 dark:hover:text-vred-300">
            Clients
          </button>
          <div
            x-anchor.offset.5="$refs.clientModalButton"
            x-show="showDropdown"
            x-collapse.duration.500ms
            class="table-scrollbar max-h-[300px] w-full overflow-auto rounded border border-slate-400 bg-vlp shadow-lg dark:bg-neutral-500">
            <ul>
              <template x-for="client in clients" :key="client.id">
                <li
                  @click="selectClient(client)"
                  class="cursor-pointer p-2 text-vls hover:bg-slate-600 dark:text-vds dark:hover:bg-neutral-600"
                  x-text="client.name"></li>
              </template>
            </ul>
          </div>
        </div>
        <div class="flex items-center justify-center">
          <button
            @click="showClientModal = !showClientModal"
            class="submit-button w-1/2 rounded bg-red-800 p-1 text-base font-medium text-slate-100 shadow-sm transition-colors duration-200 hover:bg-red-900 focus:outline-none focus:ring-2 focus:ring-red-500">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
